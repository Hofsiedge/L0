<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>WB L0 Form</title>
    <link rel="stylesheet" href="/style.css">
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  </head>
  <body>
  <script src="/index.js"></script>
  <div class="outer" x-data="{
      availableOrders: [],
      async listOrders() {
        this.availableOrders = await fetch('/api/v1/order/').then(r => r.json())
        if (!this.availableOrders.includes(this.currentOrder?.order_uid)) {
          this.currentOrder = null;
        }
      },
      currentOrder: null,
      async loadOrder(id) {
        this.currentOrder = await fetch('/api/v1/order/' + id).then(r => r.json())
      }
    }"
    x-effect="console.log(currentOrder)"
    x-init="listOrders()">

    <div class="menu">
      <button class="reload-btn" @click="listOrders()">Reload orders</button>

      <div class="uid-boxes">
        <template x-for="orderUid in availableOrders">
          <button
            x-text="orderUid"
            @click="loadOrder(orderUid)"
            x-bind:class="orderUid === currentOrder.order_uid && 'active'"
          ></button>
        </template>
      </div>
    </div>

    <template  x-if="currentOrder !== null">
    <div class="order-box">
      <template x-for="[title, obj, keys] in [
        ['Delivery Info', currentOrder.delivery, LayoutSchema.delivery],
        ['Payment Info',  currentOrder.payment,  LayoutSchema.payment],
        ['Order Info',    currentOrder,          LayoutSchema.order]
      ]">
      <div class="section-data">
        <div class="section-title" x-text="title"></div>
        <div class="section-values">
          <template x-for="[key, name] in Object.entries(keys)">
          <template x-for="i in [name + ':', obj[key]]">
          <span x-text="i"></span>
          </template>
          </template>
        </div>
      </div>
      </template>
    </div>
    </template>

    <template  x-if="currentOrder !== null">
    <div class="items">
      <div class="section-title">Items</div>
      <template x-for="item in currentOrder.items">
      <div class="item">
        <div class="section-values">
          <template x-for="[key, name] in Object.entries(LayoutSchema.item)">
          <template x-for="i in [name + ':', item[key]]">
          <span x-text="i"></span>
          </template>
          </template>
        </div>
      </div>
      </template>
    </div>
    </template>

  </div>
  </body>
</html>